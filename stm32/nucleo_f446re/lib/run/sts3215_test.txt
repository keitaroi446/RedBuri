#pragma once
#include "main.h"
#include "sts3215.hpp" 
#include <cmath>

extern UART_HandleTypeDef huart1;

namespace run
{
    inline STS3215 servo_1(&huart1, 1);
    inline int16_t targetAngle = 0; // 外部から値を変えてクレメンス.

    inline void setup()
    {
        // 初期化
        // servo_1.setMode(0);  まあ通常はいらない.
        int16_t servo_1.AdjustPosition(); // 現在角度取得.
        /* デバッグ用
        if (startPos != -1) {
            centerPosition = _startPos;
            HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET); // 成功:LED消灯
        } 
        else {
            centerPosition = 2048; // 失敗:デフォルト
            HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);   // 失敗:LED点灯
            }
        */
    }
        
    

    inline void loop()
    {
        // メインループ
        servo_1.moveRelative((int16_t)targetAngle);
        // _startPosで現在位置を持つ.
    }
}